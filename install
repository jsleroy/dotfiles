#!/bin/bash

. libui-sh/libui.sh

libui_sh_init

EXCLUDE=("install" "vimrc.loumou" "bashrc.pierre" "README.rst" "libui-sh")

usage()
{
cat << EOF
usage: $0 [OPTIONS]

This script create symlinks in \$HOME for all files found in this directory.

OPTIONS:
    -h       Show this message
    -e FILE  Exclude list file
    -f       Force installation
    -v       Verbose
EOF
}

info()
{
    if [ $VERBOSE -eq 1 ]
    then
        echo $@
    fi
}

error()
{
    echo "ERROR:" $@
}

warning()
{
    echo "WARNING:" $@
}

EXCLUDE_LIST=
VERBOSE=0
FORCE=0

while getopts "vhfe:" OPTION
do
     case $OPTION in
         h)
             usage
             exit 1
             ;;
         e)
             EXCLUDE_LIST=$OPTARG
             ;;
         f)
             FORCE=1
             ;;
         v)
             VERBOSE=1
             ;;
         ?)
             usage
             exit
             ;;
     esac
done

FILES=`ls`

# Remove in $FILES items from $EXCLUDE
for exclude in ${EXCLUDE[@]}
do
    FILES=`echo $FILES | sed "s/\b$exclude\b//g"`
done

# Create symlinks
for filename in $FILES
do
    dest=$HOME"/."$filename
    src=`pwd`"/"$filename

    info "Installing" $src

    if [ -a $dest ]
    then
        if [ $FORCE -eq 0 ]
        then
            warning "$dest already exists"
            ask_yesno "Overwrite ?" && continue
        else
            info "Deleting" $dest
            # rm -rf $dest
        fi
    fi

    info "Creating symlink" $src "to" $dest
    # ln -s $src $dest
done

